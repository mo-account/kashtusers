<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Secure Card Payment</title>
<script src="https://www.paypal.com/sdk/js?client-id=AUb04f-4T36M43K4LS2A2hv7wkhlIYWWzCfk1u4AS6f43nDsPyQ85fJHQvXYiGRhmlRdaKB4lWeXco7l&currency=USD&components=buttons,funding-eligibility"></script>
<style>
body {
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
    font-family:sans-serif;
    background:#fafafa;
}
h2 {
    margin-bottom:20px;
}
</style>
</head>
<body>
<h2>Pay Securely by Card</h2>
<div id="paypal-button-container"></div>

<script>
const amount = '5'; // Change as needed dynamically via VBA
const payerEmail = 'msabdulmanaf@se.com.sa'; // Pre-fill from VBA
const boqCount = '20'; // Change dynamically via VBA
const saudiPostalCode = '11564'; // Pre-filled postal code
const IPN_URL = 'https://script.google.com/macros/s/AKfycbxyq8_VMjMRDQ6RgIGQx0l1P-WlY_-KKbvqh-rynJ6qEKUFkLxVYzACTxfUUGhNYNxZHQ/exec';
const MerchantID = 'GEQACEXP54D7Q';
const SuccessURL = 'https://mo-account.github.io/boqusers/successful%20payment.html';

paypal.Buttons({
    fundingSource: paypal.FUNDING.CARD,
    createOrder: function(data, actions) {
        return actions.order.create({
            payer: {
                name: { given_name: '', surname: '' }, // User fills
                email_address: payerEmail,
                address: { country_code: 'SA', postal_code: saudiPostalCode },
                phone: { phone_number: { national_number: '' } } // User fills
            },
            purchase_units: [{
                amount: { value: amount },
                custom_id: payerEmail,
                payee: { merchant_id: MerchantID }
            }],
            application_context: {
                shipping_preference: 'NO_SHIPPING',
                user_action: 'PAY_NOW'
            }
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            fetch(IPN_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: payerEmail, amount: amount, boq: boqCount, status: 'COMPLETED' })
            });
            window.location.href = SuccessURL;
        });
    },
    style: {
        layout: 'vertical',
        color: 'blue',
        shape: 'pill',
        label: 'pay'
    }
}).render('#paypal-button-container');
</script>
</body>
</html>
